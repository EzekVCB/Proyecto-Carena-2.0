{% extends "base.html" %}

{% load static %}
{% load widget_tweaks %}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/styles.css' %}"> <!-- Tu CSS personalizado -->
    <title>Sistema de Ventas</title>
</head>
<body class="bg-light">

<div class="container mt-4">
    <h2 class="text-center">Sistema de Ventas</h2>
    <div class="row">
        <div class="col-md-8">
            <h4>Productos</h4>
            <table class="table table-bordered" id="tabla-productos">
                <thead class="bg-success text-white">
                    <tr>
                        <th>Código de barras</th>
                        <th>Descripción</th>
                        <th>Cantidad</th>
                        <th>Precio unitario</th>
                        <th>Importe</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Aquí se agregarán los productos seleccionados -->
                </tbody>
            </table>
            <div class="form-group">
                <label for="producto-select">Seleccionar Producto:</label>
                <select class="form-control" id="producto-select">
                    <option value="">Seleccione un producto</option>
                    {% for producto in productos %}
                        <option value="{{ producto.id }}" data-precio="{{ producto.PrecioDeLista }}">{{ producto.Descripcion }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label for="cantidad-input">Cantidad:</label>
                <input type="number" class="form-control" id="cantidad-input" min="1" value="1">
            </div>
            <button class="btn btn-primary" id="agregar-producto">Agregar Producto</button>
        </div>

        <div class="col-md-4">
            <h4>Resumen de la Venta</h4>
            <div class="card">
                <div class="card-body">
                    <p>Subtotal: <span id="subtotal">0.00</span></p>
                    <p>Descuento/Recargo: <span id="descuento">0.00</span></p>
                    <p>Total: <span id="total">0.00</span></p>
                    <button class="btn btn-success btn-lg" id="cobrar">F2-Cobrar</button>
                    <button class="btn btn-warning btn-lg" id="nueva-venta">F4-Nueva venta</button>
                    <button class="btn btn-info btn-lg" id="ver-precio">F5-Ver precio</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="{% static 'js/jquery.min.js' %}"></script>
<script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>
<script>
    $(document).ready(function() {
        $('#agregar-producto').click(function() {
            const productoSelect = $('#producto-select');
            const cantidadInput = $('#cantidad-input');
            const tablaProductos = $('#tabla-productos tbody');
            const precioUnitario = productoSelect.find(':selected').data('precio');
            const productoNombre = productoSelect.find(':selected').text();
            const cantidad = parseInt(cantidadInput.val());

            if (productoSelect.val() && cantidad > 0) {
                const subtotal = (precioUnitario * cantidad).toFixed(2);
                tablaProductos.append(`
                    <tr>
                        <td>${productoSelect.val()}</td>
                        <td>${productoNombre}</td>
                        <td>${cantidad}</td>
                        <td>${precioUnitario}</td>
                        <td>${subtotal}</td>
                    </tr>
                `);
                actualizarTotales();
            } else {
                alert('Por favor, seleccione un producto y una cantidad válida.');
            }
        });

        function actualizarTotales() {
            let subtotal = 0;
            $('#tabla-productos tbody tr').each(function() {
                subtotal += parseFloat($(this).find('td:last').text());
            });
            $('#subtotal').text(subtotal.toFixed(2));
            $('#total').text(subtotal.toFixed(2)); // Aquí puedes agregar lógica para descuentos
        }

        $('#nueva-venta').click(function() {
            $('#tabla-productos tbody').empty();
            $('#subtotal').text('0.00');
            $('#total').text('0.00');
        });

        $('#cobrar').click(function() {
            // Aquí puedes agregar la lógica para procesar la venta
            alert('Venta procesada.');
        });
    });
</script>

</body>
</html>